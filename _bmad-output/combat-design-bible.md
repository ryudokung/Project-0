# Combat Design Bible: Project-0 (The Battle Engine)

**Goal:** Define the mathematical formulas, status effects, and turn-based logic for the "Asynchronous 3D Battle Engine".

## 1. Damage Formulas
The core calculation for any attack:

$$FinalDamage = (BaseAttack \times TypeMultiplier) - (TargetDefense \times DefenseEfficiency)$$

### 1.1 Type Multipliers (Rock-Paper-Scissors)
| Attacker \ Defender | Kinetic | Energy | Explosive |
| :--- | :--- | :--- | :--- |
| **Kinetic** | 1.0x | 1.5x | 0.5x |
| **Energy** | 0.5x | 1.0x | 1.5x |
| **Explosive** | 1.5x | 0.5x | 1.0x |

### 1.2 Critical Hits
- **Crit Chance:** Base 5% + (Accuracy / 100).
- **Crit Damage:** 1.5x Final Damage.

## 2. Combat Power (CP) System
Combat Power is the primary metric for evaluating the strength of a Vehicle and its Pilot. However, to prevent "CP Pumping" (where players only focus on one number), we use **Effective CP (ECP)**.

### 2.1 The Base CP Formula
The CP is calculated using the following weights:
- **Attack (ATK):** Weight 3
- **Defense (DEF):** Weight 2
- **Health (HP):** Weight 0.2 (HP / 5)

**Formula:**
$$CP = (Total ATK \times 3) + (Total DEF \times 2) + (Total HP / 5)$$

### 2.2 Effective CP (ECP) & The "Anti-Pump" Logic
The ECP is the actual power applied during an encounter, modified by environmental and synergy factors.

**ECP Formula:**
$$ECP = (Base CP \times Suitability\_Mod) \times Resonance\_Sync\_Ratio \times (1 - Fatigue\_Penalty)$$

1. **Suitability Modifier (Terrain):**
    - **Perfect Match (1.2x):** e.g., Tank in Desert, Ship in Islands.
    - **Neutral (1.0x):** Standard conditions.
    - **Incompatible (0.5x):** e.g., Tank in Islands, Ship in Desert.
2. **Resonance Sync Ratio:**
    - If `Pilot_Resonance < Vehicle_Tier`, the ratio is calculated as `Pilot_Resonance / Vehicle_Tier`.
    - This ensures that a high-tier vehicle cannot be fully utilized by an inexperienced pilot.
3. **Fatigue Penalty:**
    - Derived from the Pilot's **Stress** level. `Penalty = Stress / 200`. At 100 Stress, the penalty is 50%.

### 2.3 Infiltration & Detection Gates
High-CP Vehicles have a high **Signature Rating**.
- **Detection Threshold:** Some nodes have a threshold (e.g., 500 Signature).
- **Alarm Trigger:** If `Vehicle_Signature > Threshold`, the node triggers **ALARM MODE**, increasing enemy stats by 200%.
- **The Solution:** Players must switch to **Pilot/Exosuit** mode (Low CP, Low Signature) or use a **Transformation** to a stealth-focused mode to bypass the gate.

### 2.4 Transformation Mechanics (Mid-Combat & Mid-Expedition)
Vehicles with the `TRANSFORMABLE` trait can switch modes to adapt to tactical needs.

*   **Mode Alpha (Travel/Stealth):** +50% Speed, -30% Signature, -20% ATK.
*   **Mode Beta (Assault):** +30% ATK, +20% DEF, -50% Speed.
*   **Tactical Shift:** Transformation costs 1 turn (in combat) or 1 click (on timeline) and 10% Fuel. It is the primary tool for overcoming terrain mismatches or detection gates.

## 3. Status Effects (The "Narrative" Combat)
Combat isn't just about HP; it's about system integrity:

- **System Overheat:** (From Energy attacks) Reduces Accuracy by 50% for 2 turns.
- **Armor Breach:** (From Kinetic attacks) Reduces Defense by 30% permanently for the mission.
- **Engine Stall:** (From Explosive attacks) Reduces Evasion to 0 for 1 turn.
- **Pilot Fatigue:** (From long missions) Reduces all stats by 10% per turn after turn 10.

## 3. The "Options" System (Sub-stats)
Options are the "Soul" of the NFT. They are generated by AI and can be:
- **Offensive:** +% Damage, +% Crit, +% Armor Pen.
- **Defensive:** +% HP, +% Evasion, +% Resistance.
- **Utility:** +% Scanner Range, -% Fuel Cost, +% Salvage Rate.

## 5. Battle Flow (The "Click-to-Action" Logic)
The battle is a series of tactical decisions triggered by clicks:
1. **Initiative Phase:** Higher Speed determines the order of clickable actions.
2. **Action Selection:** Player clicks on a target or a specific skill (e.g., "Fire Railgun", "Deploy Smoke").
3. **Resource Cost:** Every action click consumes a resource (O2 for Pilot, Fuel/Energy for Vehicles).
4. **Resolution Phase:** Damage applied, Status effects triggered.
5. **Visualization Phase:** Backend sends the "Tick Log" to the Frontend.
    - **Frontend:** Renders a high-fidelity 3D "Action Shot" (R3F) based on the click (e.g., "Vehicle A fires Railgun at Vehicle B's Left Arm").
6. **Node Resolution:** Once the enemy HP reaches zero, the combat ends, and the current node on the timeline is marked as **Resolved**. This enables the "Proceed" button to advance the expedition.

## 5. Pilot EVA Combat (High-Stakes Clicks)
EVA combat is simplified but higher risk:
- **Stealth vs. Detection:** If Stealth > Detection, Pilot gets a "Surprise Attack" (3x Damage).
- **O2 Management:** Every click (moving, searching, attacking) consumes 2-5% O2. If O2 reaches 0, Pilot dies instantly.
- **Melee Focus:** EVA combat favors Swords and Sidearms over heavy Mech weapons. Every click must be calculated.
